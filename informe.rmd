---
title: "Identificación de Cadenas Globales de Valor"
subtitle: "Aprendizaje Automático en Grafos\n\nMaestría en Explotación de Datos (UBA)"
author:
- "Franco Betteo"
- "Francisco Valentini"
date: "Julio de 2019"
lang: es
fontsize: 12pt 
output:
  bookdown::pdf_document2:
    fig_caption: yes
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=F, warning=F, message=F
                      , fig.align='center')
```


```{r libraries}
source("libraries.r")
```

```{r read-data}
# tablas centralidad
tabcen = readRDS("output/centrality.rds")
```

Uno de los rasgos salientes de la producción mundial de bienes y servicios en los últimos 50 años ha sido la deslocalización de las etapas de los procesos productivos en las llamadas *cadenas globales de valor*. En el presente trabajo usamos la información de comercio internacional intersectorial disponible en las Inter-Country Input-Output Matrices (ICIO) de la OCDE para identificar cadenas globales de valor. Para ello representamos la matriz del año 2015 como un grafo dirigido que usamos para identificar comunidades de comercio intenso, sobre las cuales aplicamos un algoritmo de detección de caminos pesados.

# Cadenas globales de valor

La producción internacional, el comercio y las inversiones se organizan cada vez más dentro de las denominadas cadenas de valor globales (CGV), donde las diferentes etapas del proceso de producción se ubican en diferentes países. Esto se debe fundamentalmente a la revolución de las TICs iniciadas a mediados de la década de 1970. Estas han permitido a las grandes empresas reducir costos y optimizar procesos reestructurando sus operaciones a nivel global, por medio de la subcontratación y la deslocalización de actividades.

De esta manera, las cadenas globales de valor se han convertido en una característica dominante del comercio mundial, afectando a las economías en desarrollo, emergentes y desarrolladas. A diferencia de lo observado a mediados de siglo XX con el auge de las ISI, la tendencia en las últimas décadas es hacia la dispersión internacional de las partes de las cadenas de valor (diseño, producción, comercialización, distribución, etc).

Esta fragmentación de los procesos productivos a nivel mundial ha sido objeto de un sinfín de análisis en el ámbito de la economía desde mediados de los 2000, los cuales apuntan a arrojar luz sobre la escala, la naturaleza y las consecuencias de este fenómeno – incluso dando origen a un propio subcampo orientado al estudio de las CGV.

# La matriz insumo producto internacional (ICIO)

Las Matrices de Insumo-Producto (MIP) describen las relaciones de compraventa entre productores y consumidores dentro de una economía. En el caso de las MIP *sector x sector*, representan los flujos de bienes y servicios finales e intermedios entre los sectores de una economía y los componentes de la demanda final, valuados en una determinada moneda en un momento del tiempo. 

La OCDE posee una base de datos que compila y armoniza las MIP nacionales adoptando el enfoque *sector x sector*. Asimismo, este organismo combina las MIP nacionales con los flujos intersectoriales internacionales de bienes y servicios para generar una MIP global, llamada ICIO (Inter-Country Input-Output).

En los bloques diagonales de la ICIO se representan las transacciones nacionales de bienes y servicios intermedios en todos los sectores, mientras que los bloques fuera de la diagonal representan los flujos de productos intermedios entre países a través de exportaciones e importaciones. Por el lado de los usos finales, se cuenta con vectores de demanda final por país, tal que sus elementos consideran tanto la demanda de bienes finales locales como la de importados (ver Figura \ref{fig:estructura}).

La tabla incluye además un vector-fila de valor agregado en cada sector de cada país. De esta manera, al sumar las compras intermedias con el valor agregado por sector (por columna) se obtiene el valor bruto de la producción de cada sector. Análogamente, al sumar las ventas intermedias y finales por sector (por fila), se obtiene el mismo guarismo de valor bruto de producción. 

```{r estructura, out.width='80%', fig.cap="Estructura la tabla ICIO"}
knitr::include_graphics(c(
  "resources/png/estructura_icio.PNG"
))
```

Los flujos de las tablas están valuados en dólares corrientes (millones de USD) para todos los países de la OCDE y 28 economías no miembros, abarcando los años 2005 a 2015. Las economías se hallan desagregadas en 36 sectores productivos (abarcando todos los sectores primarios, secundarios y terciarios) y en 6 componentes de demanda final (incluyendo consumo de los hogares, consumo del gobierno e inversión, entre otros). Los países no considerados son agrupados como “Resto del mundo” para mantener la consistencia contable del sistema (ver Figuras \ref{fig:paises} y \ref{fig:sectores} del [Anexo]).

En el presente trabajo hacemos uso de la tabla del año 2015, actualizada en diciembre de 2018.

# Preprocesamiento

Para representar la matriz como un grafo dirigido aplicamos secuencialmente la siguiente serie de transformaciones que tienen como objetivo conservar las transacciones económicamente significativas y relevantes para el ejercicio:

1. Descartamos los valores brutos de producción sectoriales, así como también el componente de demanda final de variaciones de existencias (ya que consiste en un residuo contable más que una estimación fidedigna).

2. Agrupamos los flujos correspondientes a China y México, que en la tabla de origen se hallan discriminados entre actividades procesadoras de exportaciones y no procesadoras de exportaciones.  

3. Conservamos un solo valor de demanda final para cada sector, eliminando la distinción entre consumo de los hogares, inversión, consumo público, etc.

4. Eliminamos las compraventas de cada sector consigo mismo. 

5. Conservamos únicamente las transacciones que representan simultáneamente más del 0.1% de las ventas para la parte vendedora y más del 0.1% de las compras de la parte compradora.

6. Conservamos únicamente las transacciones mayores que 1 mill. de USD.

7. Descartamos los valores de valor agregado de cada sector y el sector de servicio doméstico (ya que es puro valor agregado--no tiene compras intermedias).

# Caracterización de la red

Para determinar algunas características generales de la red resulta útil representarla como un grafo no pesado, tal que cada arista pasa a tener el mismo peso. En la Figura \ref{fig:degree-dist} se observa la distribución del grado de entrada, salida y total (entrada+salida) de los nodos en dicho grafo.

```{r degree-dist, fig.cap="Distribución del grado normalizado (Grafo no pesado)"}
knitr::include_graphics(c(
  "output/plots/degree_distribution.png"
))
```

Como es de esperar, la distribución del grado presenta un sesgo significativo hacia derecha. Esto indica que la gran mayoría de los nodos tiene bajo grado, mientras que una pequeña porción de ellos tiene grado alto.

En particular, los sectores de mayor grado de entrada son en realidad las demandas finales de los países centrales (EEUU, Alemania, Gran Bretaña, China, Francia, etc.), que reciben bienes y servicios de entre el 68% y 32% sectores del mundo. En cambio, al observar el grado de salida se destacan los sectores de servicios (Comercio mayorista y minorista y Actividades profesionales, científicas, técnicas y de servicios administrativos y de apoyo) y otras industriales (como Equipo eléctrico o Maquinaria), principalmente de EEUU, China y Alemania (ver Cuadro \ref{tab:degree-uw}). 

```{r degree-uw, out.width='80%'}
# grado entrada
deg_in_uw = tabcen$degree %>% select(sector, d_in) %>% arrange(-d_in) %>% head(10) %>% mutate(d_in=round(d_in,3))
# grado salida
deg_out_uw = tabcen$degree %>% select(sector, d_out) %>% arrange(-d_out) %>% head(10)%>% mutate(d_out=round(d_out,3))

list(deg_in_uw,deg_out_uw) %>%
  knitr::kable(caption="10 principales sectores según grado de entrada y grado de salida (Grafo no pesado)") 
```

Al considerar el grafo pesado, tomando como pesos los flujos en millones de USD, se observa que otros países ganan importancia por su grado de entrada, en particular las demandas finales de India y Brasil -- si bien no compran productos de muchas partes del mundo, consumen mucho en términos reales. En cuanto al grado de salida, ganan importancia frente al resto los sectores productivos de China y EEUU, siendo de esta manera los dos grandes productores de bienes y servicios del mundo (ver Cuadro \ref{tab:degree-w}). 

```{r degree-w, out.width='80%'}
# grado entrada
deg_in_w = tabcen$degree_w %>% select(sector, d_in) %>% arrange(-d_in) %>% head(10)
# grado salida
deg_out_w = tabcen$degree_w %>% select(sector, d_out) %>% arrange(-d_out) %>% head(10)

list(deg_in_w,deg_out_w) %>%
  knitr::kable(caption="10 principales sectores según grado de entrada y grado de salida (Grafo pesado en mill. de USD)") 
```

Para detectar sectores que son intermediarios significativos del comercio mundial (es decir, que compran y venden simultánamente de y a muchos otros sectores) calculamos la *betweenness* de cada nodo en el grafo no pesado -- estos sectores tienen un rol preponderante ya que muchos de los caminos más cortos pasan por ellos. En el Cuadro \ref{tab:centrality} observamos la importancia relativa en este sentido de los servicios de EEUU, y las industrias de China (Maquinaria y Químicos), Singapur (Metales básicos) y sorprendentemente de Eslovenia (Papeles e impresiones), entre otros.

El cálculo de la cercanía para cada nodo usando las distancias desde el resto de los nodos permite hallar sectores que se encuentran muy cerca de una gran cantidad de proveedores y consumen bienes y servicios de muchos de ellos. Por este motivo, no solo las demandas finales de países centrales tienen "cercanía de entrada" alta, sino también de países pequeños y dependientes de importaciones, como Malta, Brunei e Islandia (ver Cuadro \ref{tab:centrality}).

En cuanto a la "cercanía de salida", es sorprendente la importancia de sectores industriales de Luxemburgo y Bulgaria (Plásticos y Productos metálicos, por ejemplo). No obstante, hay que destacar que estos estadísticos están sesgados a favor de países de Europa y Asía, ya que muchos de los países de América y África estána agrupados en la categoría de "Resto del Mundo" y no tienen nodos en la red.

```{r centrality, out.width='80%'}
# betweenness
betw = tabcen$others %>% select(sector, betw) %>% arrange(-betw) %>% head(10) %>% mutate(betw=round(betw,3))
# closeness in
c_in = tabcen$others %>% select(sector, close_in) %>% arrange(-close_in) %>% head(10) %>% mutate(close_in=round(close_in,3))
# closeness out
c_out = tabcen$others %>% select(sector, close_out) %>% arrange(-close_out) %>% head(10) %>% mutate(close_out=round(close_out,3))

list(betw,c_in,c_out) %>%
  knitr::kable(caption="10 principales sectores según betweenness y cercanía (de entrada y salida) normalizados (Grafo no pesado)")
```

# Detección de comunidades

Para identificar clusters de sectores con vínculos comerciales intensos entre sí, y con poco comercio con otros sectores, usamos el algoritmo para detección de comunidades Infomap, con su implementación del paquete "igraph".
Aplicando esta técnica al grafo ponderado por peso de la transacción tanto sobre el total de exportaciones e importaciones respectivamente obtenemos 4 comunidades compuestas por sectores de mas de un país. Estas comunidades están basadas en países de gran poder económico como era de esperar. Ver Figura \ref{fig:comunidades} del [Anexo].
A modo de resumen:
* La primera involucra a muchos sectores de Estados Unidos para terminar alimentado la demanda final de este mismo país y comerciando con el sector de tecnología tanto de Mexico (principal vecino comercial) como de - llamativamente - Filipinas.
* La segunda focaliza en muchos sectores de Alemania y concluye en la propia demanda alemana y en sectores de transporte automotor de vecinos como Suiza, Francia y Hungría.
*  La tercera repite el patrón para Gran Bretaña, alimentandosu propia demanda y transaccionando con el sector de plásticos de Irlanda y telecomunicaciones de Luxemburgo.
* La cuarta tiene su núcleo en muchos sectores de Francia (incluyendo la demanda final) pero además la relaciona con la minería belga y los productos madereros de Luxemburgo.

Vemos que las comunidades identificadas se centran en cuatro potencias económicas globales y permiten detectar algunos sectores importantes de su matriz transaccional. A su vez vemos que más allá de la cercanía geográfica y el crecimiento de los intercambios comerciales todavía el comercio interno predomina en las potencias y los socios destacados son países de menor jerarquía. No hay una conexión de la misma envergadura entre estas potencias núcleo.

Esta técnica nos permite adicionalmente detectar sectores relativamente aislados del resto y que no forman parte de ninguna comunidad – outliers – que son descartados para los análisis posteriores. Es a priori esperable que muchas comunidades estén conformadas por sectores de un solo país, en los casos en que estos vínculos sean significativamente más fuertes que los que se mantienen con sectores de otros países. Estas comunidades también son descartadas ya que representan “archipiélagos” de países aislados del resto del mundo. 

# Detección de caminos pesados

Una vez identificadas las comunidades de sectores, se facilita el problema de hallar cadenas globales de valor significativas: en lugar de aplicar la función PathRanker del paquete "NetPathMiner" sobre toda la red, lo hacemos sobre cada comunidad. Este algoritmo busca los caminos más probables dado el peso de las aristas.  
Dado que las comunidades no abarcan muchos países decidimos calcular caminos que pasen por la comunidad en todas sus aristas. Es decir que cada conexión tiene que tener al menos en uno de sus extremos un nodo de la comunidad en cuestión. De esta forma pueden encontrarse otros socios comerciales que no necesariamente forman parte estrictamente de la comunidad.

Aplicamos el algoritmo a las distintas comunidades encontradas iterando sobre caminos de longitud mínima entre 5 y 10 pasos. Ver Figura \ref{fig:caminos} del [Anexo].

Algunos caminos interesantes basados en cantidad de países afectados son:
* El sector de la minería alemana proveyendo a la industria metalera local y a la maquinaria de transporte suya como hungara, francesa y del nodo resto del mundo, siendo un nicho exportador a recalcar.
* En la misma sintonía vemos que Bélgica le provee materia prima minera a Francia para alimentar varios sectores de su industria pero a su vez al sector metalúrgico alemán y al resto del mundo.
* Con e

# Anexo {#anexo}

```{r paises, out.width='80%', fig.show='hold', fig.cap="Países incluidos en ICIO (2015)"}
knitr::include_graphics(c(
  "resources/png/countries.png"
))
```

```{r sectores, out.width='80%', fig.show='hold', fig.cap="Sectores incluidos en ICIO (2015)"}
knitr::include_graphics(c(
  "resources/png/sectores.png"
))
```

```{r comunidades}
```

```{r caminos}
```


